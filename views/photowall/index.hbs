<div id="photos" class="photos">
    <div class="photo-sizer"></div>

    {{#each files}}
        <img src="{{this}}" class="photo" />
    {{else}}
        Oh no, no pics.
    {{/each}}
</div>

<div id="qr-code" class="qr-code"></div>

<script src="/scripts/socketio/socket.io.js"></script>
<script src="/scripts/qrcodejs/qrcode.js"></script>
<script src="/scripts/masonry/masonry.pkgd.js"></script>
<script src="/scripts/imagesloaded/imagesloaded.pkgd.js"></script>
<script type="application/javascript">
    enableFullscreenToggle();

    const namespace = "{{namespace}}";

    const $photosContainer = document.getElementById("photos");

    imagesLoaded($photosContainer, () => {
        const masonry = new Masonry($photosContainer, {
            itemSelector: '.photo',
            columnWidth: '.photo-sizer',
            percentPosition: true
        });

        const socket = io(`/photowall?room=${namespace}`);

        socket.on('new_file', (filename) => {
            const $image = document.createElement('img');
            $image.setAttribute("src", filename);
            $image.classList.add('photo');
            $photosContainer.prepend($image);

            $image.onload = () => {
                masonry.prepended($image);
            };
        });
    });

    const $qrCode = document.getElementById('qr-code');
    new QRCode($qrCode, slashJoin(window.location.href, "upload"));
</script>